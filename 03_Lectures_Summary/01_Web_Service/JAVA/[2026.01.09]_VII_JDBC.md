# Java DataBase Connectivity

JDBC는 자바 애플리케이션이 다양한 관계형 데이터베이스(RDBMS)에 접속하고 SQL을 실행할 수 있도록 지원하는 자바 표준 API입니다.

### 1. 구현 단계

1. Driver 로드: 사용하려는 DB용 드라이버 클래스를 메모리에 적재합니다.

2. DB 접속: IP, Port, ID, PW 정보를 이용하여 세션을 연결합니다.

3. SQL 작업: 실행할 SQL 문장을 준비합니다.

4. SQL 문장 실행: 준비된 문장을 DB 엔진으로 전송합니다.

5. 결과 활용: 조회된 데이터나 영향받은 행의 수를 처리합니다.

6. 접속 해제: 사용한 모든 자원을 역순으로 반환합니다.

### 2. 프로그램 관점

1. 드라이버 로딩: `Class.forName()`을 통해 특정 벤더의 드라이버를 로드하면 `DriverManager`가 이를 관리합니다.

2. `Connection` 객체 생성: `DriverManager`가 제공하는 정보를 바탕으로 DB와 물리적으로 연결된 `Connection` 객체를 획득합니다.

3. `Statement` 객체 생성: SQL 실행 통로인 `Statement` 객체를 생성합니다.

4. SQL 실행 및 반환:

    * DQL (`Select`): 테이블 형태의 데이터를 담은 ResultSet 객체를 반환합니다.

    * DML (`Insert` / `Update` / `Delete`): 작업으로 인해 변경된 행의 수를 `int` 타입으로 반환합니다.

5. 자원 해제: 메모리 누수 방지를 위해 LIFO(Last In First Out) 원칙에 따라 자원을 반환합니다.

    * 순서: `ResultSet` → `Statement` → `Connection`

### 3. `pom.xml` JDBC 드라이버 추가

```XML
<!-- MySQL DB 접속용 패키지 (8 버전용) -->
<dependency>
	<groupId>com.mysql</groupId>
	<artifactId>mysql-connector-j</artifactId>
	<version>8.0.33</version>
</dependency>
<!-- Oracle DB 접속용 패키지 (23c 버전용) -->
<dependency>
	<groupId>com.oracle.database.jdbc</groupId>
	<artifactId>ojdbc11</artifactId>
	<version>23.26.0.0.0</version>
</dependency>
```

### 4. DB 접속용 메소드 구현

Oracle과 MySQL을 동시에 대응할 수 있는 범용 메소드 구조

```Java
//DB의 dept 모든 데이터 검색 & 출력
static void DB(String dbType, String url, String user, String password) {
	Connection con = null;
	Statement stmt = null;
	ResultSet rs = null;
	try {
        //1. 드라이버 로딩: 바이트 코드를 메모리에 명시적으로 로드
		Class.forName(dbType);

		//2-4. 연결 및 SQL 실행
        //실제 객체는 인터페이스 (Connection)를 구현한 각 벤더사 (Oracle/MySQL)의 하위 클래스입니다.
		con = DriverManager.getConnection(url, user, password);
		stmt = con.createStatement();
		rs = stmt.executeQuery("SELECT * FROM dept");

        //5. 결과 활용 (Cursor를 이동하며 데이터 추출)
		while (rs.next()) {
			System.out.println(rs.getInt("deptno") + "\t" + rs.getString("dname") + "\t" + rs.getString("loc"));
		}
	}
	catch (ClassNotFoundException e) {
		System.err.println("드라이버를 찾을 수 없습니다: " + e.getMessage());
	}
	catch (SQLException e) {
		System.err.println("DB 작업 중 오류 발생: " + e.getMessage());
	}
	finally {
		// 6. 자원 반환: 예외 발생 여부와 상관없이 실행되어야 함 (LIFO 순서)
		try {
			if (rs != null) {
				rs.close();
				rs = null;
			}
			if (stmt != null) {
				stmt.close();
				stmt = null;
			}
			if (con != null) {
				con.close();
				con = null;
			}
		}
		catch (SQLException e) {
			e.printStackTrace();
		}
	}
}
```

### 5. 메인 메소드에서 호출

```Java
public static void main(String[] args) {
    //1. Oracle 접속 정보
    //Driver: oracle.jdbc.OracleDriver
    //URL: jdbc:oracle:thin:@IP:PORT/SERVICE_NAME
	DB("oracle.jdbc.OracleDriver", "jdbc:oracle:thin:@127.0.0.1:1521/FREEPDB1", "scott", "tiger");
	System.out.println("*".repeat(80));
    //2. MySQL 접속 정보
    //Driver: com.mysql.cj.jdbc.Driver
    //URL: jdbc:mysql://IP:PORT/DB_NAME
	DB("com.mysql.cj.jdbc.Driver", "jdbc:mysql://127.0.0.1:3306/fisa", "user01", "user01");
}
```